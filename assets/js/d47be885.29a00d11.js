"use strict";(self.webpackChunkopenfmb_docs=self.webpackChunkopenfmb_docs||[]).push([[4573],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>g});var a=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var p=a.createContext({}),s=function(e){var n=a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},u=function(e){var n=s(e.components);return a.createElement(p.Provider,{value:n},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,p=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=s(t),m=i,g=d["".concat(p,".").concat(m)]||d[m]||c[m]||r;return t?a.createElement(g,o(o({ref:n},u),{},{components:t})):a.createElement(g,o({ref:n},u))}));function g(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=m;var l={};for(var p in n)hasOwnProperty.call(n,p)&&(l[p]=n[p]);l.originalType=e,l[d]="string"==typeof e?e:i,o[1]=l;for(var s=2;s<r;s++)o[s]=t[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},3677:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>l,toc:()=>s});var a=t(7462),i=(t(7294),t(3905));const r={},o="Modbus Server",l={unversionedId:"adapter/protocol-plugins/modbus/server",id:"adapter/protocol-plugins/modbus/server",title:"Modbus Server",description:"The modbus-outstation plugin exposes OpenFMB measurements as a Modbus server",source:"@site/docs/adapter/protocol-plugins/modbus/server.md",sourceDirName:"adapter/protocol-plugins/modbus",slug:"/adapter/protocol-plugins/modbus/server",permalink:"/docs/adapter/protocol-plugins/modbus/server",draft:!1,editUrl:"https://github.com/openenergysolutions/openfmb.docs/edit/develop/website/docs/adapter/protocol-plugins/modbus/server.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Modbus Client",permalink:"/docs/adapter/protocol-plugins/modbus/client"},next:{title:"DNP3 Master",permalink:"/docs/adapter/protocol-plugins/dnp3/master"}},p={},s=[{value:"General Configuration",id:"general-configuration",level:2},{value:"Non-control Profiles",id:"non-control-profiles",level:2},{value:"Boolean",id:"boolean",level:3},{value:"Int32, Int64 and Float",id:"int32-int64-and-float",level:3},{value:"Enum",id:"enum",level:3},{value:"Control Profiles",id:"control-profiles",level:2},{value:"Boolean",id:"boolean-1",level:3},{value:"Int32, Int64 and Float",id:"int32-int64-and-float-1",level:3},{value:"Enum",id:"enum-1",level:3},{value:"Schedule parameters",id:"schedule-parameters",level:3}],u={toc:s},d="wrapper";function c(e){let{components:n,...t}=e;return(0,i.kt)(d,(0,a.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"modbus-server"},"Modbus Server"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"modbus-outstation")," plugin exposes OpenFMB measurements as a Modbus server\nfor non-control OpenFMB profiles. It also maps Modbus write commands to OpenFMB\ncontrol messages."),(0,i.kt)("h2",{id:"general-configuration"},"General Configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"name"),": the name used in the logs to identify the communication session."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"log-level"),": protocol log level to print to the logs"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"adapter"),": network adapter to use to establish a TCP connection (typically\n0.0.0.0)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"port"),": TCP port on which the outstation will be listening"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"unit-identifier"),": Modbus unit identifier of the outstation (aka address)"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"max-num-connections"),": maximum number of concurrent TCP connections to the\nserver")),(0,i.kt)("h2",{id:"non-control-profiles"},"Non-control Profiles"),(0,i.kt)("p",null,"Non-control profiles (reading, status, etc) are mapped to Modbus coils, discrete\ninputs, holding registers and input registers. When the message is received on\nthe internal message bus, it updates the internal Modbus database. Then, masters\npolling the outstation read the updated values."),(0,i.kt)("p",null,"Each OpenFMB value can be mapped to multiple Modbus values."),(0,i.kt)("h3",{id:"boolean"},"Boolean"),(0,i.kt)("p",null,"OpenFMB Boolean values can be mapped to one or more coil and discrete input(s).\nIf ",(0,i.kt)("inlineCode",{parentName:"p"},"negate")," is set to ",(0,i.kt)("inlineCode",{parentName:"p"},"true"),", the OpenFMB value is negated before updating the\nModbus outstation."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'tab="coil"',tab:'"coil"'},"bool-field-type: mapped\nactions:\n    - destination-type: coil  # {none, coil, discrete_input}\n    index: 10\n    negate: false\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'tab="discrete_input"',tab:'"discrete_input"'},"bool-field-type: mapped\nactions:\n    - destination-type: discrete_input  # {none, coil, discrete_input}\n    index: 11\n    negate: true\n")),(0,i.kt)("h3",{id:"int32-int64-and-float"},"Int32, Int64 and Float"),(0,i.kt)("p",null,"OpenFMB ",(0,i.kt)("inlineCode",{parentName:"p"},"int32"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"int64")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"float")," values can be mapped to a Modbus holding\nregister or a Modbus input register. A scaling value can also be specified."),(0,i.kt)("p",null,"For 32-bit values, two indices are specified: one containing the two LSBs\nand the other containing the two MSBs."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'tab="sint16"',tab:'"sint16"'},"float-field-type: mapped\nactions:\n- destination-type: holding_register  # {none, holding_register, input_register}\n    register-mapping: sint16  # {sint16, uint16, sint32, uint32, float32}\n    index: 0\n    scale: 1\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'tab="uint16"',tab:'"uint16"'},"float-field-type: mapped\nactions:\n- destination-type: input_register  # {none, holding_register, input_register}\n    register-mapping: uint16  # {sint16, uint16, sint32, uint32, float32}\n    index: 0\n    scale: 1\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'tab="sint32"',tab:'"sint32"'},"float-field-type: mapped\nactions:\n- destination-type: holding_register  # {none, holding_register, input_register}\n    register-mapping: sint32  # {sint16, uint16, sint32, uint32, float32}\n    lower_index: 0\n    upper_index: 1\n    scale: 1\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'tab="uint32"',tab:'"uint32"'},"float-field-type: mapped\nactions:\n- destination-type: input_register  # {none, holding_register, input_register}\n    register-mapping: uint32  # {sint16, uint16, sint32, uint32, float32}\n    lower_index: 0\n    upper_index: 1\n    scale: 1\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'tab="float32"',tab:'"float32"'},"float-field-type: mapped\nactions:\n- destination-type: holding_register  # {none, holding_register, input_register}\n    register-mapping: float32  # {sint16, uint16, sint32, uint32, float32}\n    lower_index: 0\n    upper_index: 1\n    scale: 1\n")),(0,i.kt)("h3",{id:"enum"},"Enum"),(0,i.kt)("p",null,"OpenFMB enumerations can be mapped to multiple values in the Modbus database.\nFor each variant, a coil or discrete input can be updated to a fixed value, or a\nholding register or input register can be updated to a fixed value."),(0,i.kt)("p",null,"A list of each enum variant is specified with the desired actions to perform."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"enum-field-type: mapped\nmapping:\n    - name: DynamicTestKind_none\n      actions:\n        - destination-type: coil  # {none, coil, discrete_input, holding_register, input_register}\n          index: 0\n          value: true\n    - name: DynamicTestKind_testing\n      actions:\n        - destination-type: discrete_input  # {none, coil, discrete_input, holding_register, input_register}\n          index: 1\n          value: false\n    - name: DynamicTestKind_operating\n      actions:\n        - destination-type: holding_register  # {none, coil, discrete_input, holding_register, input_register}\n          index: 2\n          value: 42\n    - name: DynamicTestKind_failed\n      actions:\n        - destination-type: input_register  # {none, coil, discrete_input, holding_register, input_register}\n          index: 3\n          value: 76\n")),(0,i.kt)("h2",{id:"control-profiles"},"Control Profiles"),(0,i.kt)("p",null,"Modbus write commands can be translated to OpenFMB control profile messages."),(0,i.kt)("p",null,"There are three actions that can be specified for each point:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"update"),": simply updates the current profile"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"clean_and_update"),": clears the current message and updates the value"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"publish"),": updates the current message and sends it to the message bus")),(0,i.kt)("p",null,"All the write targets are mapped to values in the internal database. Therefore,\na read will report the last written value."),(0,i.kt)("h3",{id:"boolean-1"},"Boolean"),(0,i.kt)("p",null,"Boolean values in control profiles can be mapped from Modbus writes to coils.\nOptionally, the value can be negated."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"bool-field-type: mapped\ncommand-source-type: coil  # {none, coil}\nprofile-action: update_and_publish  # {update, clear_and_update, update_and_publish}\nindex: 0\nnegate: false\n")),(0,i.kt)("h3",{id:"int32-int64-and-float-1"},"Int32, Int64 and Float"),(0,i.kt)("p",null,"Integer and floating point values can be mapped from one or more holding\nregister writes. If multiple writes are required, be sure to use ",(0,i.kt)("inlineCode",{parentName:"p"},"update"),".\nOtherwise, transient values will be published."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'tab="sint16"',tab:'"sint16"'},"float-field-type: mapped\ncommand-source-type: holding_register  # {none, holding_register}\nregister-mapping: sint16  # {sint16, uint16, sint32, uint32, float32}\nprofile-action: update_and_publish  # {update, clear_and_update, update_and_publish}\nindex: 0\nscale: 1\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'tab="uint16"',tab:'"uint16"'},"float-field-type: mapped\ncommand-source-type: holding_register  # {none, holding_register}\nregister-mapping: uint16  # {sint16, uint16, sint32, uint32, float32}\nprofile-action: update_and_publish  # {update, clear_and_update, update_and_publish}\nindex: 0\nscale: 1\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'tab="sint32"',tab:'"sint32"'},"float-field-type: mapped\ncommand-source-type: holding_register  # {none, holding_register}\nregister-mapping: sint32  # {sint16, uint16, sint32, uint32, float32}\nprofile-action: update  # {update, clear_and_update, update_and_publish}\nlower_index: 0\nupper_index: 1\nscale: 1\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'tab="uint32"',tab:'"uint32"'},"float-field-type: mapped\ncommand-source-type: holding_register  # {none, holding_register}\nregister-mapping: uint32  # {sint16, uint16, sint32, uint32, float32}\nprofile-action: update  # {update, clear_and_update, update_and_publish}\nlower_index: 0\nupper_index: 1\nscale: 1\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'tab="float32"',tab:'"float32"'},"float-field-type: mapped\ncommand-source-type: holding_register  # {none, holding_register}\nregister-mapping: float32  # {sint16, uint16, sint32, uint32, float32}\nprofile-action: update  # {update, clear_and_update, update_and_publish}\nlower_index: 0\nupper_index: 1\nscale: 1\n")),(0,i.kt)("h3",{id:"enum-1"},"Enum"),(0,i.kt)("p",null,"Register writes can be mapped to OpenFMB enums. A list of enumeration variants\nis provided with the source register value."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"enum-field-type: mapped\ncommand-source-type: analog_output  # {none, analog_output}\nprofile-action: update_and_publish  # {update, clear_and_update, update_and_publish}\nindex: 10\nmapping:\n  - name: StateKind_off\n    value: 0\n  - name: StateKind_on\n    value: 1\n  - name: StateKind_standby\n    value: 2\n")),(0,i.kt)("h3",{id:"schedule-parameters"},"Schedule parameters"),(0,i.kt)("p",null,"These are currently not supported."))}c.isMDXComponent=!0}}]);