<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.73">
<link rel="alternate" type="application/rss+xml" href="/openfmb.docs/blog/rss.xml" title="OpenFMB Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/openfmb.docs/blog/atom.xml" title="OpenFMB Blog Atom Feed"><title data-react-helmet="true">Creating a new plugin | OpenFMB</title><meta data-react-helmet="true" property="og:url" content="https://openenergysolutions.github.io/openfmb.docs//openfmb.docs/docs/adapter/extending"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Creating a new plugin | OpenFMB"><meta data-react-helmet="true" name="description" content="Internal architecture"><meta data-react-helmet="true" property="og:description" content="Internal architecture"><link data-react-helmet="true" rel="shortcut icon" href="/openfmb.docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://openenergysolutions.github.io/openfmb.docs//openfmb.docs/docs/adapter/extending"><link data-react-helmet="true" rel="alternate" href="https://openenergysolutions.github.io/openfmb.docs//openfmb.docs/docs/adapter/extending" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://openenergysolutions.github.io/openfmb.docs//openfmb.docs/docs/adapter/extending" hreflang="x-default"><link rel="stylesheet" href="/openfmb.docs/assets/css/styles.3e93676a.css">
<link rel="preload" href="/openfmb.docs/assets/js/styles.d18e3207.js" as="script">
<link rel="preload" href="/openfmb.docs/assets/js/runtime~main.dc3e0ed2.js" as="script">
<link rel="preload" href="/openfmb.docs/assets/js/main.38a362fb.js" as="script">
<link rel="preload" href="/openfmb.docs/assets/js/1.bc5ccd76.js" as="script">
<link rel="preload" href="/openfmb.docs/assets/js/2.e1ad69f2.js" as="script">
<link rel="preload" href="/openfmb.docs/assets/js/3.6aeb9867.js" as="script">
<link rel="preload" href="/openfmb.docs/assets/js/1be78505.e42d13d3.js" as="script">
<link rel="preload" href="/openfmb.docs/assets/js/58.1502ba12.js" as="script">
<link rel="preload" href="/openfmb.docs/assets/js/935f2afb.fc3a7c55.js" as="script">
<link rel="preload" href="/openfmb.docs/assets/js/17896441.10338110.js" as="script">
<link rel="preload" href="/openfmb.docs/assets/js/f3e8e883.fcce2019.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/openfmb.docs/"><img src="/openfmb.docs/img/logo.png" alt="Open Energy Solutions Inc - OpenFMB" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/openfmb.docs/img/logo.png" alt="Open Energy Solutions Inc - OpenFMB" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">OpenFMB</strong></a><a class="navbar__item navbar__link navbar__link--active" href="/openfmb.docs/docs/tutorial/intro">Tutorial</a><a class="navbar__item navbar__link navbar__link--active" href="/openfmb.docs/docs/adapter/index">Adapter</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/openenergysolutions/openfmb.docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/openfmb.docs/"><img src="/openfmb.docs/img/logo.png" alt="Open Energy Solutions Inc - OpenFMB" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/openfmb.docs/img/logo.png" alt="Open Energy Solutions Inc - OpenFMB" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">OpenFMB</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/openfmb.docs/docs/tutorial/intro">Tutorial</a></li><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/openfmb.docs/docs/adapter/index">Adapter</a></li><li class="menu__list-item"><a href="https://github.com/openenergysolutions/openfmb.docs" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tutorial</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/openfmb.docs/docs/tutorial/intro">Introduction to OpenFMB (Open Field Message Bus)</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Adapter</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/openfmb.docs/docs/adapter/index">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/openfmb.docs/docs/adapter/protos">Protos</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/openfmb.docs/docs/adapter/cli">CLI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/openfmb.docs/docs/adapter/schemas">Schemas</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/openfmb.docs/docs/adapter/config">Configuration</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Native Plugins</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/openfmb.docs/docs/adapter/native-plugins/nats">NATS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/openfmb.docs/docs/adapter/native-plugins/mqtt">MQTT</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/openfmb.docs/docs/adapter/native-plugins/dds">DDS</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Protocol Plugins</a><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">Modbus</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/openfmb.docs/docs/adapter/protocol-plugins/modbus/master">Modbus Master</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/openfmb.docs/docs/adapter/protocol-plugins/modbus/outstation">Modbus Outstation</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="-1">DNP3</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/openfmb.docs/docs/adapter/protocol-plugins/dnp3/master">DNP3 Master</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/openfmb.docs/docs/adapter/protocol-plugins/dnp3/outstation">DNP3 Outstation</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Other Plugins</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/openfmb.docs/docs/adapter/other-plugins/capture-replay">Capture and Replay plugins</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/openfmb.docs/docs/adapter/other-plugins/log">Log plugin</a></li></ul></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/openfmb.docs/docs/adapter/extending">Extending</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!" tabindex="0">Advanced Configuration</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/openfmb.docs/docs/adapter/misc/scheduling">Scheduling</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/openfmb.docs/docs/adapter/misc/self-signed">Self-signed certificates</a></li></ul></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Adapter Config Tool</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/openfmb.docs/docs/adapter-config-tool/index">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/openfmb.docs/docs/adapter-config-tool/download">Download</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/openfmb.docs/docs/adapter-config-tool/install">Install</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/openfmb.docs/docs/adapter-config-tool/source">Source Code</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/openfmb.docs/docs/adapter-config-tool/quick-guide">Quick Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/openfmb.docs/docs/adapter-config-tool/defs">Terminology and Definitions</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Human Machine Interface</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/openfmb.docs/docs/hmi/index">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/openfmb.docs/docs/hmi/docker">Docker Image</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/openfmb.docs/docs/hmi/configuration">Setting up the HMI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/openfmb.docs/docs/hmi/run">Run the HMI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/openfmb.docs/docs/hmi/sld">Single-Line Diagram</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Creating a new plugin</h1></header><div class="markdown"><p>Internal architecture</p><p>The internal architecture of the OpenFMB adapter consists of an internal publisher/subscriber
message bus and a plugin registry. Each OpenFMB profile has its own &quot;channel&quot; on the bus, and
the generated C++ protobuf objects are the canonical model used within the application to pass
data between plugins. At startup, all plugins are initialized based on configuration files.
During initialization, plugins may subscribe to the internal message bus to receive profiles
when published by another plugin. Once all plugins are loaded, they are started. From this point,
plugins may publish profiles to the internal message bus. All plugins that subscribed for this
type of message will get notified of the new message and will be able to forward it to the external
world.</p><p>The following diagram shows an example of how the adapter works:</p><p><img alt="Adapter acting as a protocol translator" src="/openfmb.docs/assets/images/protocol-translator-9bd96e43bef4d1aed7df755009585f57.svg"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="native-vs-legacy-plugins"></a>Native vs legacy plugins<a class="hash-link" href="#native-vs-legacy-plugins" title="Direct link to heading">#</a></h2><p>Native plugins are OpenFMB aware, i.e. they use the OpenFMB model coupled to a messsaging transport
defined by the OpenFMB standard (e.g. NATs/ MQTT / etc). The messages are directly serialized/deserialized
off the wire as OpenFMB models and don&#x27;t require a custom mapping. For example, the NATS plugin reads
and writes the OpenFMB messages in their Protobuf representation and sends/receives them to/from a NATS broker.
Similarly, the DDS plugin directly (de)serializes the OpenFMB messages directly from the DDS representation.</p><p>Legacy plugins need a custom mapping to translate OpenFMB messages to/from the
underlying protocol. For example, the DNP3 master plugin needs to transform
OpenFMB control messages to DNP3 commands. It also maps measurement readings
from DNP3 points to OpenFMB values, sometimes performing scaling. These
transformations requires the user to write mapping files to transform the values
read from DNP3 points to OpenFMB values and vice versa.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="creating-a-plugin"></a>Creating a plugin<a class="hash-link" href="#creating-a-plugin" title="Direct link to heading">#</a></h2><p>The first step to create a plugin is to add a new CMake target that links to
<code>adapter-util</code>. Preferably, the compilation of this new target should be
conditional on some CMake variable. Refer to the <code>CMakeLists.txt</code> of the existing
plugins as a template.</p><p>The target must expose an implementation of the top level C++ API class <code>IPluginFactory</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">* Top level API class for creating a new plugin</span></div><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">*/</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">IPluginFactory</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">public</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">virtual</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">~</span><span class="token function" style="color:rgb(130, 170, 255)">IPluginFactory</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">default</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// unique name of the plugin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">virtual</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain">string </span><span class="token function" style="color:rgb(130, 170, 255)">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// description of the plugin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">virtual</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain">string </span><span class="token function" style="color:rgb(130, 170, 255)">description</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// JSON schema for top-level configuration file</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">virtual</span><span class="token plain"> schema</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain">Object </span><span class="token function" style="color:rgb(130, 170, 255)">get_plugin_schema</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// JSON schema for the mapping files, the per-profile schema</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">virtual</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain">vector</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">schema</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain">property_ptr_t</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_session_schema</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">throw</span><span class="token plain"> api</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">Exception</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;does not support writing session configuration&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// JSON schema for a particular profile</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">virtual</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain">vector</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">schema</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain">property_ptr_t</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">get_profile_schema</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain">string</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> profile</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">throw</span><span class="token plain"> api</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token function" style="color:rgb(130, 170, 255)">Exception</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token function" style="color:rgb(130, 170, 255)">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;does not support writing session configuration&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// returns a `api::IPlugin` for the plugin</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">virtual</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain">unique_ptr</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">IPlugin</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> YAML</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain">Node</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> node</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> Logger</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> logger</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> message_bus_t bus</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p><strong>Note:</strong></p><ul><li><p><code>get_plugin_schema</code>:
For native plugins, it generally includes information to connect to the
broker. For legacy plugins, it generally includes global configuration and an
array of YAML templates. <code>util::yaml::get_template_schema</code> is useful to create
the JSON schema of such templates.</p></li><li><p><code>get_session_schema</code>: returns the JSON schema of the mapping files, without
the per-profile schema. For legacy plugins, this generally includes
information to connect to the legacy device and other shared information
across the profile mappings. This method should not be
implemented for native plugins.</p></li><li><p><code>get_profile_schema</code>: returns the JSON schema for a particular profile. When
generating JSON schemas, this callback will be called for every profile. For
legacy plugins, you should use <code>api::ProfileRegistry::handle_by_name</code> and a
<code>SchemaWriteVisitorBase</code> to visit the profile and write the schema for each
field. This method should not be implemented for native plugins.</p></li></ul><p>You should then an implementation of <code>api::IPlugin</code> to return when <code>IPluginFactory::create(..)</code> is called:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cpp"><div tabindex="0" class="prism-code language-cpp codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">IPlugin</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">public</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">virtual</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">~</span><span class="token function" style="color:rgb(130, 170, 255)">IPlugin</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">default</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// supplies the same name as the factory</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">virtual</span><span class="token plain"> std</span><span class="token operator" style="color:rgb(137, 221, 255)">::</span><span class="token plain">string </span><span class="token function" style="color:rgb(130, 170, 255)">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// start the execution of the adapter</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">virtual</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The constructor will take the YAML node of the plugin, a logger and the internal message
bus. It should read the configuration and subscribe to the required messages on
the message bus if necessary. The <code>start</code> method is called once all the plugins
are created. This is where the plugin should start listening for incoming
messages to relay/interpret. This method is synchronous, so it should generally
spawn a background thread or use another library callback mechanism to subscribe
for messages and return immediately. The destructor should gracefully stop
listening and wait for any background threads created.</p><p>For legacy plugins, the <code>api::IPlugin</code> implementation should read mapping
configuration from templated YAML files. The <code>util::yaml::load_template_configs</code>
can be used to automatically read the templated YAML files with the values
properly replaced. Then, for each profile, <code>api::ProfileRegistry::handle_by_name</code>
can be used with a <code>SubscribingConfigReadVisitorBase</code> or a <code>PublishingConfigReadVisitorBase</code> to
navigate the profile mappings and build the internal representation of the
mappings.</p><p>The final step of adding your plugin to the application is putting it in the
<code>PluginRegistry</code> of the <code>application</code> target. Conditional compilation should
be use to include the plugin only when a particular CMake variable is set.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/openenergysolutions/openfmb.docs/edit/develop/website/docs/adapter/extending.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/openfmb.docs/docs/adapter/other-plugins/log"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Log plugin</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/openfmb.docs/docs/adapter/misc/scheduling"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Scheduling Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#native-vs-legacy-plugins" class="table-of-contents__link">Native vs legacy plugins</a></li><li><a href="#creating-a-plugin" class="table-of-contents__link">Creating a plugin</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/openfmb.docs/docs/tutorial/intro">Tutorial</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/openfmb" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/openenergysolutions/openfmb.docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Open Energy Solutions, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/openfmb.docs/assets/js/styles.d18e3207.js"></script>
<script src="/openfmb.docs/assets/js/runtime~main.dc3e0ed2.js"></script>
<script src="/openfmb.docs/assets/js/main.38a362fb.js"></script>
<script src="/openfmb.docs/assets/js/1.bc5ccd76.js"></script>
<script src="/openfmb.docs/assets/js/2.e1ad69f2.js"></script>
<script src="/openfmb.docs/assets/js/3.6aeb9867.js"></script>
<script src="/openfmb.docs/assets/js/1be78505.e42d13d3.js"></script>
<script src="/openfmb.docs/assets/js/58.1502ba12.js"></script>
<script src="/openfmb.docs/assets/js/935f2afb.fc3a7c55.js"></script>
<script src="/openfmb.docs/assets/js/17896441.10338110.js"></script>
<script src="/openfmb.docs/assets/js/f3e8e883.fcce2019.js"></script>
</body>
</html>